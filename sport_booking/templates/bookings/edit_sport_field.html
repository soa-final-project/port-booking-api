<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏µ‡∏¨‡∏≤ - Spot4Sport</title>
    <style>
        /* ‡πÉ‡∏ä‡πâ CSS ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö sport_field.html */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #BF092F 0%, #8B0623 100%);
            padding: 20px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            color: white;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .admin-badge {
            background: #132440;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        /* Container */
        .container {
            display: flex;
            min-height: calc(100vh - 85px);
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 30px 0;
        }

        .menu-item {
            padding: 15px 30px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #666;
            font-weight: 500;
        }

        .menu-item:hover {
            background: #f8f9fa;
            color: #132440;
            border-left: 4px solid #132440;
            padding-left: 26px;
        }

        .menu-item.active {
            background: #132440;
            color: white;
            border-left: 4px solid #BF092F;
            padding-left: 26px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 40px;
        }

        .page-header {
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 32px;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: #666;
        }

        /* Form Container */
        .form-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 35px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group label .required {
            color: #e74c3c;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #132440;
            box-shadow: 0 0 0 3px rgba(19, 36, 64, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .image-upload {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-upload:hover {
            border-color: #132440;
            background: #f8f9fa;
        }

        .image-upload input[type="file"] {
            display: none;
        }

        .upload-icon {
            font-size: 48px;
            color: #132440;
            margin-bottom: 10px;
        }

        .upload-text {
            color: #666;
            font-size: 14px;
        }

        .image-preview {
            margin-top: 15px;
            display: none;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }

        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #132440;
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            background: #0f1d33;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(19, 36, 64, 0.3);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
            flex: 1;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .success-message,
        .error-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .field-hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .current-image {
            margin-bottom: 15px;
        }

        .current-image img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
            }

            .main-content {
                padding: 20px;
            }

            .form-container {
                padding: 25px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div style="display: flex; align-items: center; gap: 20px;">
            <div class="logo">SPOT4SPORT</div>
            <div class="admin-badge">üë®‚Äçüíº Admin Panel</div>
        </div>
    </div>

    <!-- Container -->
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="menu-item" onclick="window.location.href='/api/admin-dashboard/'">
                <span style="font-size: 20px;">üìä</span>
                <span>Dashboard</span>
            </div>
            <div class="menu-item" onclick="window.location.href='/api/admin-dashboard/'">
                <span style="font-size: 20px;">üìÖ</span>
                <span>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</span>
            </div>
            <div class="menu-item active">
                <span style="font-size: 20px;">üèüÔ∏è</span>
                <span>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏µ‡∏¨‡∏≤</span>
            </div>
            <div class="menu-item" onclick="window.location.href='/api/admin-dashboard/'">
                <span style="font-size: 20px;">üë•</span>
                <span>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</span>
            </div>
            <div class="menu-item" onclick="window.location.href='/api/index/'">
                <span style="font-size: 20px;">üè†</span>
                <span>‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="page-header">
                <h1 class="page-title">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏µ‡∏¨‡∏≤</h1>
                <p class="page-subtitle">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏µ‡∏¨‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
            </div>

            <div class="form-container">
                <div class="success-message" id="successMessage"></div>
                <div class="error-message" id="errorMessage"></div>

                <form id="editFieldForm">
                    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
                    <div class="form-section">
                        <h3 class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h3>
                        
                        <div class="form-group">
                            <label for="name">
                                ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ô‡∏≤‡∏° <span class="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="name" 
                                name="name" 
                                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏ô‡∏≤‡∏°‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• A1"
                                required
                            >
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="sport_type">
                                    ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏µ‡∏¨‡∏≤ <span class="required">*</span>
                                </label>
                                <select id="sport_type" name="sport_type" required>
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏µ‡∏¨‡∏≤ --</option>
                                    <option value="football">‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•</option>
                                    <option value="futsal">‡∏ü‡∏∏‡∏ï‡∏ã‡∏≠‡∏•</option>
                                    <option value="basketball">‡∏ö‡∏≤‡∏™‡πÄ‡∏Å‡∏ï‡∏ö‡∏≠‡∏•</option>
                                    <option value="volleyball">‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå‡∏ö‡∏≠‡∏•</option>
                                    <option value="badminton">‡πÅ‡∏ö‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏±‡∏ô</option>
                                    <option value="tennis">‡πÄ‡∏ó‡∏ô‡∏ô‡∏¥‡∏™</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="status">
                                    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ <span class="required">*</span>
                                </label>
                                <select id="status" name="status" required>
                                    <option value="available">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                                    <option value="maintenance">‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="description">
                                ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            </label>
                            <textarea 
                                id="description" 
                                name="description" 
                                placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡∏™‡∏ô‡∏≤‡∏° ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏¥‡πà‡∏á‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏ô‡∏≤‡∏° ‡∏Ø‡∏•‡∏Ø"
                            ></textarea>
                            <div class="field-hint">‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏ô‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô</div>
                        </div>
                    </div>

                    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤ -->
                    <div class="form-section">
                        <h3 class="section-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="capacity">
                                    ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏ (‡∏Ñ‡∏ô) <span class="required">*</span>
                                </label>
                                <input 
                                    type="number" 
                                    id="capacity" 
                                    name="capacity" 
                                    placeholder="‡πÄ‡∏ä‡πà‡∏ô 22"
                                    min="1"
                                    required
                                >
                                <div class="field-hint">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏™‡∏ô‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ</div>
                            </div>

                            <div class="form-group">
                                <label for="price_per_hour">
                                    ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (‡∏ø) <span class="required">*</span>
                                </label>
                                <input 
                                    type="number" 
                                    id="price_per_hour" 
                                    name="price_per_hour" 
                                    placeholder="‡πÄ‡∏ä‡πà‡∏ô 500"
                                    min="0"
                                    step="0.01"
                                    required
                                >
                                <div class="field-hint">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏™‡∏ô‡∏≤‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</div>
                            </div>
                        </div>
                    </div>

                    <!-- ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û -->
                    <div class="form-section">
                        <h3 class="section-title">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏ô‡∏≤‡∏°</h3>
                        
                        <div class="current-image" id="currentImageContainer">
                            <p>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</p>
                            <img id="currentImage" src="" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏ô‡∏≤‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô">
                        </div>
                        
                        <div class="form-group">
                            <label class="image-upload" for="image">
                                <input 
                                    type="file" 
                                    id="image" 
                                    name="image" 
                                    accept="image/*"
                                    onchange="previewImage(event)"
                                >
                                <div class="upload-text">
                                    <strong>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà</strong><br>
                                    <span>‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà ‡πÉ‡∏´‡πâ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ</span>
                                </div>
                                <div class="image-preview" id="imagePreview">
                                    <img id="previewImg" src="" alt="Preview">
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-danger" id="deleteBtn" onclick="confirmDelete()">
                            ‡∏•‡∏ö‡∏™‡∏ô‡∏≤‡∏°
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="goBack()">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö ID ‡∏Ç‡∏≠‡∏á‡∏™‡∏ô‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        let fieldId = null;

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ô‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        window.addEventListener('DOMContentLoaded', async function() {
            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
                window.location.href = '/api/login-form/';
                return;
            }

            // ‡∏î‡∏∂‡∏á ID ‡∏Ç‡∏≠‡∏á‡∏™‡∏ô‡∏≤‡∏°‡∏à‡∏≤‡∏Å URL
            const urlParams = new URLSearchParams(window.location.search);
            fieldId = urlParams.get('id');
            
            if (!fieldId) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ô‡∏≤‡∏°');
                window.location.href = '/api/admin-dashboard/';
                return;
            }

            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ô‡∏≤‡∏°‡∏à‡∏≤‡∏Å API
            await loadFieldData(fieldId);
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ô‡∏≤‡∏°
        async function loadFieldData(id) {
            try {
                const result = await callAPI(`/api/sport-fields/${id}/`, 'GET');
                
                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
                document.getElementById('name').value = result.name || '';
                document.getElementById('sport_type').value = result.sport_type || '';
                document.getElementById('description').value = result.description || '';
                document.getElementById('capacity').value = result.capacity || '';
                document.getElementById('price_per_hour').value = result.price_per_hour || '';
                document.getElementById('status').value = result.status || 'available';
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                if (result.image) {
                    document.getElementById('currentImage').src = result.image;
                    document.getElementById('currentImageContainer').style.display = 'block';
                } else {
                    document.getElementById('currentImageContainer').style.display = 'none';
                }
                
            } catch (error) {
                console.error('Failed to load field data:', error);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ô‡∏≤‡∏°‡πÑ‡∏î‡πâ');
                window.location.href = '/api/admin-dashboard/';
            }
        }

        // Preview uploaded image
        function previewImage(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');

            if (file) {
                // Check file size (5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB)');
                    event.target.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // API Call Function
        async function callAPI(url, method = 'GET', data = null, isFormData = false) {
            const token = localStorage.getItem('access_token');
            const config = {
                method: method,
                headers: {}
            };
            
            if (token) {
                config.headers['Authorization'] = `Bearer ${token}`;
            }
            
            if (data) {
                if (isFormData) {
                    config.body = data;
                } else {
                    config.headers['Content-Type'] = 'application/json';
                    config.body = JSON.stringify(data);
                }
            }
            
            try {
                const response = await fetch(url, config);
                
                if (!response.ok) {
                    if (response.status === 401) {
                        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                        window.location.href = '/api/login-form/';
                        return;
                    }
                    const errorData = await response.json();
                    throw new Error(JSON.stringify(errorData));
                }
                
                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                throw error;
            }
        }

        // Form submission
        const form = document.getElementById('editFieldForm');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const submitBtn = document.getElementById('submitBtn');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            // Hide previous messages
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';

            // Disable submit button
            submitBtn.disabled = true;
            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            // Prepare form data
            const formData = new FormData();
            formData.append('name', document.getElementById('name').value);
            formData.append('sport_type', document.getElementById('sport_type').value);
            formData.append('description', document.getElementById('description').value);
            formData.append('capacity', document.getElementById('capacity').value);
            formData.append('price_per_hour', document.getElementById('price_per_hour').value);
            formData.append('status', document.getElementById('status').value);

            // Add image if selected
            const imageFile = document.getElementById('image').files[0];
            if (imageFile) {
                formData.append('image', imageFile);
            }

            try {
                const result = await callAPI(`/api/sport-fields/${fieldId}/`, 'PUT', formData, true);
                
                // Show success message
                successMessage.textContent = '‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏µ‡∏¨‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏≤‡∏°...';
                successMessage.style.display = 'block';

                // Redirect after 2 seconds
                setTimeout(() => {
                    window.location.href = '/api/admin-dashboard/';
                }, 2000);

            } catch (error) {
                // Show error message
                let errorMsg = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ô‡∏≤‡∏°';
                
                try {
                    const errorData = JSON.parse(error.message);
                    if (errorData.name) errorMsg = '‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ô‡∏≤‡∏°: ' + errorData.name[0];
                    else if (errorData.capacity) errorMsg = '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏: ' + errorData.capacity[0];
                    else if (errorData.price_per_hour) errorMsg = '‡∏£‡∏≤‡∏Ñ‡∏≤: ' + errorData.price_per_hour[0];
                } catch (e) {
                    errorMsg = error.message;
                }

                errorMessage.textContent = '‚ùå ' + errorMsg;
                errorMessage.style.display = 'block';

                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';

                // Scroll to error message
                errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö
        function confirmDelete() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏ô‡∏≤‡∏°‡∏ô‡∏µ‡πâ? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ')) {
                deleteField();
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏™‡∏ô‡∏≤‡∏°
        async function deleteField() {
            const deleteBtn = document.getElementById('deleteBtn');
            
            // Disable delete button
            deleteBtn.disabled = true;
            deleteBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...';

            try {
                await callAPI(`/api/sport-fields/${fieldId}/`, 'DELETE');
                
                // Show success message
                successMessage.textContent = '‚úÖ ‡∏•‡∏ö‡∏™‡∏ô‡∏≤‡∏°‡∏Å‡∏µ‡∏¨‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏≤‡∏°...';
                successMessage.style.display = 'block';

                // Redirect after 2 seconds
                setTimeout(() => {
                    window.location.href = '/api/admin-dashboard/';
                }, 2000);

            } catch (error) {
                console.error('Failed to delete field:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏ô‡∏≤‡∏°');
                
                // Re-enable delete button
                deleteBtn.disabled = false;
                deleteBtn.textContent = '‡∏•‡∏ö‡∏™‡∏ô‡∏≤‡∏°';
            }
        }

        // Go back function
        function goBack() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç? ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏∞‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢')) {
                window.location.href = '/api/admin-dashboard/';
            }
        }
    </script>
</body>
</html>